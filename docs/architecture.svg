<?xml version="1.0" encoding="UTF-8"?>
<svg width="900" height="600" viewBox="0 0 900 600" xmlns="http://www.w3.org/2000/svg">
  <!-- Definitions for markers and gradients -->
  <defs>
    <!-- Arrow markers with different colors -->
    <marker id="arrow-blue" viewBox="0 0 10 10" refX="9" refY="5"
      markerWidth="6" markerHeight="6" orient="auto">
      <path d="M 0 0 L 10 5 L 0 10 z" fill="#0066cc"/>
    </marker>
    <marker id="arrow-green" viewBox="0 0 10 10" refX="9" refY="5"
      markerWidth="6" markerHeight="6" orient="auto">
      <path d="M 0 0 L 10 5 L 0 10 z" fill="#008800"/>
    </marker>
    <marker id="arrow-orange" viewBox="0 0 10 10" refX="9" refY="5"
      markerWidth="6" markerHeight="6" orient="auto">
      <path d="M 0 0 L 10 5 L 0 10 z" fill="#cc6600"/>
    </marker>

    <!-- Gradients for component backgrounds -->
    <linearGradient id="client-gradient" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" stop-color="#e6f2ff" />
      <stop offset="100%" stop-color="#cce5ff" />
    </linearGradient>
    <linearGradient id="server-gradient" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" stop-color="#e6ffe6" />
      <stop offset="100%" stop-color="#ccffcc" />
    </linearGradient>
    <linearGradient id="ollama-gradient" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" stop-color="#fff2e6" />
      <stop offset="100%" stop-color="#ffe6cc" />
    </linearGradient>
  </defs>

  <!-- Background -->
  <rect x="0" y="0" width="900" height="600" fill="#f9f9f9" rx="10" ry="10"/>

  <!-- Title -->
  <text x="450" y="40" font-family="Arial, sans-serif" font-size="24" font-weight="bold" text-anchor="middle">Ollama WebSocket System Architecture</text>

  <!-- ===== COMPONENT BOXES ===== -->

  <!-- Client Section -->
  <rect x="50" y="100" width="200" height="380" rx="10" ry="10"
        fill="url(#client-gradient)" stroke="#0066cc" stroke-width="2"/>
  <text x="150" y="130" font-family="Arial, sans-serif" font-size="20" font-weight="bold" text-anchor="middle">Clients</text>

  <!-- WebSocket Server Section -->
  <rect x="350" y="100" width="200" height="380" rx="10" ry="10"
        fill="url(#server-gradient)" stroke="#008800" stroke-width="2"/>
  <text x="450" y="130" font-family="Arial, sans-serif" font-size="20" font-weight="bold" text-anchor="middle">WebSocket Server</text>

  <!-- Ollama Server Section -->
  <rect x="650" y="100" width="200" height="380" rx="10" ry="10"
        fill="url(#ollama-gradient)" stroke="#cc6600" stroke-width="2"/>
  <text x="750" y="130" font-family="Arial, sans-serif" font-size="20" font-weight="bold" text-anchor="middle">Ollama Server</text>

  <!-- ===== CLIENT COMPONENTS ===== -->
  <rect x="75" y="160" width="150" height="40" rx="5" ry="5" fill="white" stroke="#0066cc" stroke-width="1.5"/>
  <text x="150" y="185" font-family="Arial, sans-serif" font-size="14" text-anchor="middle">Browser Client</text>

  <rect x="75" y="220" width="150" height="40" rx="5" ry="5" fill="white" stroke="#0066cc" stroke-width="1.5"/>
  <text x="150" y="245" font-family="Arial, sans-serif" font-size="14" text-anchor="middle">Node.js Client</text>

  <rect x="75" y="280" width="150" height="40" rx="5" ry="5" fill="white" stroke="#0066cc" stroke-width="1.5"/>
  <text x="150" y="305" font-family="Arial, sans-serif" font-size="14" text-anchor="middle">Python Client</text>

  <rect x="75" y="340" width="150" height="40" rx="5" ry="5" fill="white" stroke="#0066cc" stroke-width="1.5"/>
  <text x="150" y="365" font-family="Arial, sans-serif" font-size="14" text-anchor="middle">Custom Clients</text>

  <rect x="75" y="400" width="150" height="40" rx="5" ry="5" fill="white" stroke="#0066cc" stroke-width="1.5"/>
  <text x="150" y="425" font-family="Arial, sans-serif" font-size="14" text-anchor="middle">Mobile Applications</text>

  <!-- ===== WEBSOCKET SERVER COMPONENTS ===== -->
  <rect x="375" y="160" width="150" height="40" rx="5" ry="5" fill="white" stroke="#008800" stroke-width="1.5"/>
  <text x="450" y="185" font-family="Arial, sans-serif" font-size="14" text-anchor="middle">Authentication</text>

  <rect x="375" y="220" width="150" height="40" rx="5" ry="5" fill="white" stroke="#008800" stroke-width="1.5"/>
  <text x="450" y="245" font-family="Arial, sans-serif" font-size="14" text-anchor="middle">Challenge-Response</text>

  <rect x="375" y="280" width="150" height="40" rx="5" ry="5" fill="white" stroke="#008800" stroke-width="1.5"/>
  <text x="450" y="305" font-family="Arial, sans-serif" font-size="14" text-anchor="middle">Rate Limiting</text>

  <rect x="375" y="340" width="150" height="40" rx="5" ry="5" fill="white" stroke="#008800" stroke-width="1.5"/>
  <text x="450" y="365" font-family="Arial, sans-serif" font-size="14" text-anchor="middle">Stream Management</text>

  <rect x="375" y="400" width="150" height="40" rx="5" ry="5" fill="white" stroke="#008800" stroke-width="1.5"/>
  <text x="450" y="425" font-family="Arial, sans-serif" font-size="14" text-anchor="middle">Client Registry</text>

  <!-- ===== OLLAMA SERVER COMPONENTS ===== -->
  <rect x="675" y="160" width="150" height="40" rx="5" ry="5" fill="white" stroke="#cc6600" stroke-width="1.5"/>
  <text x="750" y="185" font-family="Arial, sans-serif" font-size="14" text-anchor="middle">LLM API</text>

  <rect x="675" y="220" width="150" height="40" rx="5" ry="5" fill="white" stroke="#cc6600" stroke-width="1.5"/>
  <text x="750" y="245" font-family="Arial, sans-serif" font-size="14" text-anchor="middle">Model Loading</text>

  <rect x="675" y="280" width="150" height="40" rx="5" ry="5" fill="white" stroke="#cc6600" stroke-width="1.5"/>
  <text x="750" y="305" font-family="Arial, sans-serif" font-size="14" text-anchor="middle">Text Generation</text>

  <rect x="675" y="340" width="150" height="40" rx="5" ry="5" fill="white" stroke="#cc6600" stroke-width="1.5"/>
  <text x="750" y="365" font-family="Arial, sans-serif" font-size="14" text-anchor="middle">Token Streaming</text>

  <rect x="675" y="400" width="150" height="40" rx="5" ry="5" fill="white" stroke="#cc6600" stroke-width="1.5"/>
  <text x="750" y="425" font-family="Arial, sans-serif" font-size="14" text-anchor="middle">Model Management</text>

  <!-- ===== CONNECTION FLOWS ===== -->

  <!-- Authentication Flow -->
  <!-- 1. Challenge -->
  <line x1="225" y1="180" x2="375" y2="180" stroke="#0066cc" stroke-width="2" marker-end="url(#arrow-blue)"/>
  <text x="300" y="170" font-family="Arial, sans-serif" font-size="12" text-anchor="middle" fill="#0066cc">1. Challenge</text>

  <!-- 2. Authentication -->
  <line x1="375" y1="200" x2="225" y2="200" stroke="#0066cc" stroke-width="2" stroke-dasharray="5,3" marker-end="url(#arrow-blue)"/>
  <text x="300" y="220" font-family="Arial, sans-serif" font-size="12" text-anchor="middle" fill="#0066cc">2. Signed Response</text>

  <!-- Generation Flow -->
  <!-- 3. Generate Request -->
  <line x1="225" y1="300" x2="375" y2="300" stroke="#008800" stroke-width="2" marker-end="url(#arrow-green)"/>
  <text x="300" y="290" font-family="Arial, sans-serif" font-size="12" text-anchor="middle" fill="#008800">3. Generate Request</text>

  <!-- 4. API Request to Ollama -->
  <line x1="525" y1="300" x2="675" y2="300" stroke="#008800" stroke-width="2" marker-end="url(#arrow-green)"/>
  <text x="600" y="290" font-family="Arial, sans-serif" font-size="12" text-anchor="middle" fill="#008800">4. API Request</text>

  <!-- 5. Token Streaming from Ollama -->
  <line x1="675" y1="360" x2="525" y2="360" stroke="#cc6600" stroke-width="2" stroke-dasharray="5,3" marker-end="url(#arrow-orange)"/>
  <text x="600" y="380" font-family="Arial, sans-serif" font-size="12" text-anchor="middle" fill="#cc6600">5. Token Stream</text>

  <!-- 6. Stream to Client -->
  <line x1="375" y1="360" x2="225" y2="360" stroke="#cc6600" stroke-width="2" stroke-dasharray="5,3" marker-end="url(#arrow-orange)"/>
  <text x="300" y="380" font-family="Arial, sans-serif" font-size="12" text-anchor="middle" fill="#cc6600">6. Stream to Client</text>

  <!-- ===== LEGEND ===== -->
  <rect x="100" y="510" width="700" height="60" rx="5" ry="5" fill="white" stroke="#dddddd" stroke-width="1"/>
  <text x="450" y="535" font-family="Arial, sans-serif" font-size="16" font-weight="bold" text-anchor="middle">Legend</text>

  <!-- Authentication -->
  <line x1="170" y1="555" x2="220" y2="555" stroke="#0066cc" stroke-width="2"/>
  <text x="225" y="560" font-family="Arial, sans-serif" font-size="14" dx="5" text-anchor="start">Authentication Flow</text>

  <!-- Generation Request -->
  <line x1="400" y1="555" x2="450" y2="555" stroke="#008800" stroke-width="2"/>
  <text x="455" y="560" font-family="Arial, sans-serif" font-size="14" dx="5" text-anchor="start">Request Flow</text>

  <!-- Response -->
  <line x1="630" y1="555" x2="680" y2="555" stroke="#cc6600" stroke-width="2" stroke-dasharray="5,3"/>
  <text x="685" y="560" font-family="Arial, sans-serif" font-size="14" dx="5" text-anchor="start">Response Flow</text>
</svg>
